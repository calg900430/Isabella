@model Isabella.Web.ViewModels.CategorieViewModel.AddCategorieViewModel;


@{
    ViewData["Title"] = "Crear";
    ViewData["Name"] = "Nombre";
}

<h2>@ViewData["Title"]</h2>
<hr />
@*Formulario para crear una nueva categoria*@
<div class="row">
    <div class="col-lg-auto">
        <form asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="Name" class="control-label">@ViewData["Name"]</label>
                <input id="nameCategorie" asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>
            <div class="form-group">
                <button type="submit" value="Create" id="createCategorie"
                        class="btn btn-primary">
                    <i class="fa fa-save"></i> Crear
                </button>
                <a asp-action="Index" class="btn btn-success"><i class="fa fa-chevron-left"></i> Atrás</a>
            </div>
        </form>
    </div>
</div>
<hr />
@*Alertas*@
<div id="alertSuccess" class="alert alert-dismissible alert-success collapse" style="display:none;">
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    <strong>Well done!</strong> You successfully read <a href="#" class="alert-link">this important alert message</a>.
</div>
<div id="alertErrror" class="alert alert-dismissible alert-danger collapse" style="display:none;">
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    <strong>Oh snap!</strong> <a href="#" class="alert-link">Change a few things up</a> and try submitting again.
</div>

@section Scripts
{
    @*Ejecuta los scripts para generar el color rojo en los textos de error*@
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script type="text/javascript">
        $(document).ready(function () {

            let url = getUriServer() + 'product/create';

            //Evento click del botón q manda a crear la nueva categoria
            $('#createCategorie').click(async function (e) {
                e.preventDefault();
                //Obtiene la URI y crea la el endpoint para crear un nuevo producto
               
                //Obtiene los datos de la categoria
                var name = $('#nameCategorie').val();
                let AddProductViewModel = {
                    Name: name,
                    CategorieId: 1,
                    Price: 23,
                    IsAvailabe: true,
                    SupportAggregate: true,
                    Stock: 10,
                    Description: "sdfsdfsdfsdfsdfsdfsdf"
                };

                 let responseService = await fetch(url, {
                        method: 'POST',
                        headers:
                        {
                           'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(AddProductViewModel)
                 });

                if (responseService.ok) {
                       
                        return false;
                }

                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(AddCategorieDto)
                }).then(function (response) {
                    if (response.ok)
                    {
                        $('#alertSuccess').show();
                        //window.location.href = '/Categorie';
                    }
                    else if (response.status === 400)
                    {
                        $('#alertError').show();
                    }
                })
                    .then(function (data) {
                        console.log(data);
                    })
                    .catch(function (error) {
                        console.log(error);
                    })
            });

            //Evento

            //Agregar nuevo producto
        });
    </script>
}